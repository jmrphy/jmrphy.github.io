<div class="highlight"><pre>x<span class="o">&lt;-</span>read.csv<span class="p">(</span><span class="s">&quot;tweets_#gazaunderattack.csv&quot;</span><span class="p">,</span> header<span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span> stringsAsFactors<span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span>
x<span class="o">$</span>username<span class="o">&lt;-</span>x<span class="o">$</span>V2
x<span class="o">$</span>text<span class="o">&lt;-</span>x<span class="o">$</span>V5
 
<span class="c1">#########################################</span>
<span class="c1">#### Nice Time-Series Plot ####</span>
<span class="c1">#########################################</span>
library<span class="p">(</span>ggplot2<span class="p">)</span>
x<span class="o">$</span>date <span class="o">&lt;-</span> strptime<span class="p">(</span>x<span class="o">$</span>V4<span class="p">,</span> <span class="s">&quot;%a, %d %b %Y %H:%M:%S %z&quot;</span><span class="p">,</span> tz <span class="o">=</span> <span class="s">&quot;EST&quot;</span><span class="p">)</span>
x<span class="o">$</span>date <span class="o">&lt;-</span> as.POSIXct<span class="p">(</span>x<span class="o">$</span>date<span class="p">,</span> tz <span class="o">=</span> <span class="s">&quot;EST&quot;</span><span class="p">)</span>
timeseries<span class="o">&lt;-</span>ggplot<span class="p">(</span>data<span class="o">=</span>x<span class="p">,</span> aes<span class="p">(</span>x<span class="o">=</span>date<span class="p">))</span> <span class="o">+</span> geom_bar<span class="p">(</span>aes<span class="p">(</span>fill<span class="o">=</span>..count..<span class="p">),</span> binwidth<span class="o">=</span><span class="m">60</span><span class="o">*</span><span class="m">30</span><span class="p">)</span> <span class="o">+</span> theme_bw<span class="p">()</span> <span class="o">+</span> ylab<span class="p">(</span><span class="s">&quot;# of Tweets&quot;</span><span class="p">)</span> <span class="o">+</span> xlab<span class="p">(</span><span class="s">&quot;Time&quot;</span><span class="p">)</span>
timeseries
ggsave<span class="p">(</span>file<span class="o">=</span><span class="s">&quot;timeseries.png&quot;</span><span class="p">)</span>
 
<span class="c1">#########################################</span>
<span class="c1">#### Nice Plot of Frequent Tweeters ####</span>
<span class="c1">#########################################</span>
library<span class="p">(</span>ggplot2<span class="p">)</span>
x<span class="o">$</span>username<span class="p">[</span>x<span class="o">$</span>username<span class="o">==</span><span class="s">&quot;&quot;</span><span class="p">]</span><span class="o">&lt;-</span><span class="kc">NA</span>
length<span class="p">(</span>unique<span class="p">(</span>x<span class="o">$</span>username<span class="p">))</span> <span class="c1"># see how many unique tweeter accounts in the sample</span>
counts<span class="o">=</span>table<span class="p">(</span>x<span class="o">$</span>username<span class="p">)</span>
counts.sort<span class="o">&lt;-</span>sort<span class="p">(</span>counts<span class="p">)</span>
counts.sort.subset<span class="o">=</span>subset<span class="p">(</span>counts.sort<span class="p">,</span> counts.sort<span class="o">&gt;</span><span class="m">350</span><span class="p">)</span> <span class="c1"># create a subset of those who tweeted at least 350 times or more</span>
counts.sort.subset.df<span class="o">&lt;-</span>data.frame<span class="p">(</span>people<span class="o">=</span>unlist<span class="p">(</span>dimnames<span class="p">(</span>counts.sort.subset<span class="p">)),</span>count<span class="o">=</span>unlist<span class="p">(</span>counts.sort.subset<span class="p">))</span> <span class="c1"># makes a funny sort of data frame...</span>
counts.sort.subset.df<span class="o">&lt;-</span>data.frame<span class="p">(</span>people<span class="o">=</span>as.factor<span class="p">(</span>counts.sort.subset.df<span class="o">$</span>people<span class="p">),</span>counts<span class="o">=</span>as.numeric<span class="p">(</span>counts.sort.subset.df<span class="o">$</span>count<span class="p">))</span> <span class="c1"># makes a better data frame for ggplot to work with</span>
ggplot<span class="p">(</span>counts.sort.subset.df<span class="p">,</span> aes<span class="p">(</span>reorder<span class="p">(</span>people<span class="p">,</span>counts<span class="p">),</span>counts<span class="p">))</span> <span class="o">+</span> xlab<span class="p">(</span><span class="s">&quot;Author&quot;</span><span class="p">)</span> <span class="o">+</span> ylab<span class="p">(</span><span class="s">&quot;Number of messages&quot;</span><span class="p">)</span><span class="o">+</span> geom_bar<span class="p">()</span> <span class="o">+</span> coord_flip<span class="p">()</span> <span class="o">+</span> theme_bw<span class="p">()</span> <span class="o">+</span> opts<span class="p">(</span>axis.title.x <span class="o">=</span> theme_text<span class="p">(</span>vjust <span class="o">=</span> <span class="m">-0.5</span><span class="p">,</span> size <span class="o">=</span> <span class="m">14</span><span class="p">))</span> <span class="o">+</span> opts<span class="p">(</span>axis.title.y<span class="o">=</span>theme_text<span class="p">(</span>size <span class="o">=</span> <span class="m">14</span><span class="p">,</span> angle<span class="o">=</span><span class="m">90</span><span class="p">))</span> <span class="c1"># plot nicely ordered counts of tweets by person for people &gt; 5 tggsave(file = &quot;tweet_counts.pdf&quot;) # export the plot to a PDF file</span>
ggsave<span class="p">(</span>file <span class="o">=</span> <span class="s">&quot;tweet_counts.png&quot;</span><span class="p">)</span>
 
<span class="c1">###########################################</span>
<span class="c1">#### Nice Plot of Frequent Re-Tweeters ####</span>
<span class="c1">###########################################</span>
library<span class="p">(</span>stringr<span class="p">)</span>
x<span class="o">$</span>text<span class="o">=</span>sapply<span class="p">(</span>x<span class="o">$</span>text<span class="p">,</span><span class="kr">function</span><span class="p">(</span>row<span class="p">)</span> iconv<span class="p">(</span>row<span class="p">,</span>to<span class="o">=</span><span class="s">&#39;UTF-8&#39;</span><span class="p">))</span> <span class="c1">#remove odd characters</span>
trim <span class="o">&lt;-</span> <span class="kr">function</span> <span class="p">(</span>x<span class="p">)</span> sub<span class="p">(</span><span class="s">&#39;@&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">,</span>x<span class="p">)</span> <span class="c1"># remove @ symbol from user names</span>
x<span class="o">$</span>rt<span class="o">=</span>sapply<span class="p">(</span>x<span class="o">$</span>text<span class="p">,</span><span class="kr">function</span><span class="p">(</span>tweet<span class="p">)</span> trim<span class="p">(</span>str_match<span class="p">(</span>tweet<span class="p">,</span><span class="s">&quot;^RT (@[[:alnum:]_]*)&quot;</span><span class="p">)[</span><span class="m">2</span><span class="p">]))</span> <span class="c1">#extract who has been RT’d</span>
sum<span class="p">(</span><span class="o">!</span>is.na<span class="p">(</span>x<span class="o">$</span>rt<span class="p">))</span> <span class="c1"># see how many tweets are retweets</span>
sum<span class="p">(</span><span class="o">!</span>is.na<span class="p">(</span>x<span class="o">$</span>rt<span class="p">))</span><span class="o">/</span>length<span class="p">(</span>x<span class="o">$</span>rt<span class="p">)</span> <span class="c1"># the ratio of retweets to tweets</span>
countRT<span class="o">&lt;-</span>table<span class="p">(</span>x<span class="o">$</span>rt<span class="p">)</span>
countRT<span class="o">&lt;-</span>sort<span class="p">(</span>countRT<span class="p">)</span>
countRT.subset<span class="o">=</span>subset<span class="p">(</span>countRT<span class="p">,</span>countRT<span class="o">&gt;</span><span class="m">1000</span><span class="p">)</span> <span class="c1"># subset those RT’d more than 1000 times</span>
countRT.subset.df<span class="o">&lt;-</span>data.frame<span class="p">(</span>people<span class="o">=</span>as.factor<span class="p">(</span>unlist<span class="p">(</span>dimnames<span class="p">(</span>countRT.subset<span class="p">))),</span>RT_count<span class="o">=</span>as.numeric<span class="p">(</span>unlist<span class="p">(</span>countRT.subset<span class="p">)))</span>
ggplot<span class="p">(</span>countRT.subset.df<span class="p">,</span> aes<span class="p">(</span>reorder<span class="p">(</span>people<span class="p">,</span>RT_count<span class="p">),</span>RT_count<span class="p">))</span> <span class="o">+</span>
 xlab<span class="p">(</span><span class="s">&quot;Author&quot;</span><span class="p">)</span> <span class="o">+</span> ylab<span class="p">(</span><span class="s">&quot;Number of messages retweeted by others&quot;</span><span class="p">)</span> <span class="o">+</span>
 geom_bar<span class="p">()</span> <span class="o">+</span> coord_flip<span class="p">()</span> <span class="o">+</span> theme_bw<span class="p">()</span> <span class="o">+</span>
 opts<span class="p">(</span>axis.title.x <span class="o">=</span> theme_text<span class="p">(</span>vjust <span class="o">=</span> <span class="m">-0.5</span><span class="p">,</span> size <span class="o">=</span> <span class="m">14</span><span class="p">))</span> <span class="o">+</span>
 opts<span class="p">(</span>axis.title.y<span class="o">=</span>theme_text<span class="p">(</span>size <span class="o">=</span> <span class="m">14</span><span class="p">,</span> angle<span class="o">=</span><span class="m">90</span><span class="p">))</span>
 <span class="c1"># plot nicely ordered counts of tweets by person for people &gt; 1000 retweets</span>
ggsave<span class="p">(</span>file <span class="o">=</span> <span class="s">&quot;retweet_counts.png&quot;</span><span class="p">)</span>
 
<span class="c1">###########################################</span>
<span class="c1">#### Nice Plot of RT-Tweet Ratios #########</span>
<span class="c1">###########################################</span>
t<span class="o">&lt;-</span>as.data.frame<span class="p">(</span>table<span class="p">(</span>x<span class="o">$</span>username<span class="p">))</span> <span class="c1"># make table with counts of tweets per person</span>
rt<span class="o">&lt;-</span>as.data.frame<span class="p">(</span>table<span class="p">(</span>x<span class="o">$</span>rt<span class="p">))</span> <span class="c1"># make table with counts of retweets per person</span>
t.rt<span class="o">&lt;-</span>merge<span class="p">(</span>t<span class="p">,</span>rt<span class="p">,</span>by<span class="o">=</span><span class="s">&quot;Var1&quot;</span><span class="p">)</span> <span class="c1"># combine tweet count and retweet count per person</span>
t.rt<span class="p">[</span><span class="s">&quot;ratio&quot;</span><span class="p">]</span><span class="o">&lt;-</span>t.rt<span class="o">$</span>Freq.y <span class="o">/</span> t.rt<span class="o">$</span>Freq.x <span class="c1"># creates new col and adds ratio tweet/retweet</span>
sort.t.rt<span class="o">&lt;-</span>t.rt<span class="p">[</span>order<span class="p">(</span>t.rt<span class="o">$</span>ratio<span class="p">),]</span> <span class="c1"># sort it to put names in order by ratio</span>
sort.t.rt.subset<span class="o">&lt;-</span>subset<span class="p">(</span>sort.t.rt<span class="p">,</span>sort.t.rt<span class="o">$</span>Freq.y<span class="o">&gt;</span><span class="m">1000</span><span class="p">)</span> <span class="c1"># exclude those with 1000 tweets or less</span>
sort.t.rt.subset.drop<span class="o">&lt;-</span>droplevels<span class="p">(</span>sort.t.rt.subset<span class="p">)</span> <span class="c1"># drop unused levels that got in there somehow... note that this is already a data frame</span>
ggplot<span class="p">(</span>sort.t.rt.subset<span class="p">,</span> aes<span class="p">(</span>reorder<span class="p">(</span>Var1<span class="p">,</span>ratio<span class="p">),</span>ratio<span class="p">))</span> <span class="o">+</span>
 xlab<span class="p">(</span><span class="s">&quot;Author&quot;</span><span class="p">)</span> <span class="o">+</span> ylab<span class="p">(</span><span class="s">&quot;Retweets as a ratio of total tweets&quot;</span><span class="p">)</span> <span class="o">+</span>
 geom_bar<span class="p">()</span> <span class="o">+</span> coord_flip<span class="p">()</span> <span class="o">+</span> theme_bw<span class="p">()</span> <span class="o">+</span>
 opts<span class="p">(</span>axis.title.x <span class="o">=</span> theme_text<span class="p">(</span>vjust <span class="o">=</span> <span class="m">-0.5</span><span class="p">,</span> size <span class="o">=</span> <span class="m">14</span><span class="p">))</span> <span class="o">+</span>
 opts<span class="p">(</span>axis.title.y<span class="o">=</span>theme_text<span class="p">(</span>size <span class="o">=</span> <span class="m">14</span><span class="p">,</span> angle<span class="o">=</span><span class="m">90</span><span class="p">))</span>
ggsave<span class="p">(</span>file <span class="o">=</span> <span class="s">&quot;retweet_ratios.png&quot;</span><span class="p">)</span>
 
<span class="c1">###########################################</span>
<span class="c1">#### Nice Plot of Most Popular Links ######</span>
<span class="c1">###########################################</span>
x<span class="o">$</span>link<span class="o">=</span>sapply<span class="p">(</span>x<span class="o">$</span>text<span class="p">,</span><span class="kr">function</span><span class="p">(</span>tweet<span class="p">)</span> str_extract<span class="p">(</span>tweet<span class="p">,(</span><span class="s">&quot;http[[:print:]]+&quot;</span><span class="p">)))</span> <span class="c1"># creates new field and extracts the links contained in the tweet</span>
x<span class="o">$</span>link<span class="o">=</span>sapply<span class="p">(</span>x<span class="o">$</span>text<span class="p">,</span><span class="kr">function</span><span class="p">(</span>tweet<span class="p">)</span> str_extract<span class="p">(</span>tweet<span class="p">,</span><span class="s">&quot;http[[:print:]]{16}&quot;</span><span class="p">))</span> <span class="c1"># limits to just 16 characters after http so I just get the shortened link. They are all shortened, so this is fine, but there might be a better way using regex.</span>
countlink<span class="o">&lt;-</span>table<span class="p">(</span>x<span class="o">$</span>link<span class="p">)</span> <span class="c1"># get frequencies of each link</span>
countlink<span class="o">&lt;-</span>sort<span class="p">(</span>countlink<span class="p">)</span> <span class="c1"># sort them</span>
barplot<span class="p">(</span>countlink<span class="p">)</span> <span class="c1"># plot freqs</span>
<span class="c1"># or to use ggplot2, read on...</span>
countlink<span class="o">&lt;-</span>data.frame<span class="p">(</span>table<span class="p">(</span>na.omit<span class="p">((</span>x<span class="o">$</span>link<span class="p">))))</span>
countlink<span class="o">&lt;-</span>subset<span class="p">(</span>countlink<span class="p">,</span>countlink<span class="o">$</span>Freq<span class="o">&gt;</span><span class="m">300</span><span class="p">)</span> <span class="c1"># exclude those with 300 tweets or less</span>
ggplot<span class="p">(</span>countlink<span class="p">,</span> aes<span class="p">(</span>reorder<span class="p">(</span>Var1<span class="p">,</span> Freq<span class="p">),</span> Freq<span class="p">))</span> <span class="o">+</span>
 geom_bar<span class="p">()</span> <span class="o">+</span> coord_flip<span class="p">()</span> <span class="o">+</span> theme_bw<span class="p">()</span> <span class="o">+</span>
 xlab<span class="p">(</span><span class="s">&quot;Link&quot;</span><span class="p">)</span> <span class="o">+</span> ylab<span class="p">(</span><span class="s">&quot;Frequency&quot;</span><span class="p">)</span> <span class="o">+</span>
 opts<span class="p">(</span>axis.title.x <span class="o">=</span> theme_text<span class="p">(</span>vjust <span class="o">=</span> <span class="m">-0.5</span><span class="p">,</span> size <span class="o">=</span> <span class="m">14</span><span class="p">))</span> <span class="o">+</span>
 opts<span class="p">(</span>axis.title.y<span class="o">=</span>theme_text<span class="p">(</span>size <span class="o">=</span> <span class="m">14</span><span class="p">,</span> angle<span class="o">=</span><span class="m">90</span><span class="p">))</span>
ggsave<span class="p">(</span>file <span class="o">=</span> <span class="s">&quot;links.png&quot;</span><span class="p">)</span>
</pre></div>